@using MyWebsite.Domain.Entities
@model MyWebsite.Application.DTOs.ViewModels.ProductViewModel
@{
    var companyInfo = Context.Items["CompanyInfo"] as CompanyInfo;
    var title = "Chi tiết sản phẩm";
    ViewData["Title"] = title;
}

<style>
    .product-image-slide {
        height: 0;
        padding-bottom: 100%; /* 75%; /* Điều chỉnh tỷ lệ khung hình ở đây, ví dụ 4:3 */
        position: relative;
    }

    .product-image-slide img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
</style>

<!-- Page Title -->
<div class="page-title" data-aos="fade">
    <div class="heading">
        <div class="container">
            <div class="row d-flex justify-content-center text-center">
                <div class="col-lg-8">
                    <h1>@title</h1>
                </div>
            </div>
        </div>
    </div>
    <nav class="breadcrumbs">
        <div class="container">
            <ol>
                <li><a asp-controller="Home" asp-action="Index">Trang chủ</a></li>
                <li class="current">@title</li>
            </ol>
        </div>
    </nav>
</div><!-- End Page Title -->
<!-- Portfolio Details Section -->
<section id="portfolio-details" class="portfolio-details contact section">

    <div class="container" data-aos="fade-up" data-aos-delay="100">

        <div class="row gy-4">

            <div class="col-lg-6">
                <div class="portfolio-details-slider swiper init-swiper">

                    <script type="application/json" class="swiper-config">
                        {
                          "loop": true,
                          "speed": 600,
                          "autoplay": {
                            "delay": 5000
                          },
                          "slidesPerView": "auto",
                          "pagination": {
                            "el": ".swiper-pagination",
                            "type": "bullets",
                            "clickable": true
                          }
                        }
                    </script>

                    <div class="swiper-wrapper align-items-center">

                        @{
                            var imgSrcMain = MyWebsite.UI.Utilities.ImageHelper.GetImageSource(Model.ImageData, "client/assets/img/portfolio/app-1.jpg");
                        }

                        <div class="swiper-slide product-image-slide">
                            <img src="@imgSrcMain" />
                        </div>

                        @foreach(var item in Model.Images)
                        {
                            try
                            {
                                var imgSrc = MyWebsite.UI.Utilities.ImageHelper.GetImageSource(item.Data, "client/assets/img/portfolio/app-1.jpg");

                                <div class="swiper-slide product-image-slide">
                                    <img src="@imgSrc" alt="" />
                                </div>
                            }
                            catch (Exception e)
                            {
                                Console.WriteLine(e);
                            }
                        }

                    </div>
                    <div class="swiper-pagination"></div>
                </div>
            </div>

            <div class="col-lg-6">
                <div class="portfolio-info" data-aos="fade-up" data-aos-delay="200">
                    <h3>Thông tin sản phẩm</h3>
                    <p class="mb-0">@Model.Summary</p>
                    <ul>
                        <li><strong>Loại sản phẩm</strong>: @Model.Category?.Name</li>

                        @* TODO: Xử lý phần này sau *@
                        @* @foreach (var item in (ViewBag.ProductAttributes as List<ProductAttributeValue>)!)
                        {
                            <li><strong>@item.ProductAttribute?.Name</strong>: @item.Value</li> 
                        } *@

                        @* Nguồn gốc	Việt Nam *@
                        @* Khối lượng	900g *@
                        @* Trạng thái	Mới *@
                        @* Màu	Nâu *@
                        @* Chất liệu	Sợi đay *@
                        @* Kích thước	65×100 *@
                    </ul>

                    <form asp-action="SaveQuotation" asp-controller="Product" method="post" id="formQuotation" enctype="multipart/form-data" class="php-email-form" data-aos="fade-up" data-aos-delay="500">
                        <div class="row gy-4">
                            <input type="hidden" name="productId" value="@Model.Id" />
                            <div class="col-md-6">
                                <input type="text" name="customerName" class="form-control" placeholder="Tên" required>
                            </div>

                            <div class="col-md-6 ">
                                <input type="email" class="form-control" name="customerEmail" placeholder="Email">
                            </div>

                            <div class="col-md-12">
                                <input type="text" class="form-control" name="customerPhone" placeholder="Số điện thoại" required>
                            </div>

                            <div class="col-md-12">
                                <textarea class="form-control" name="content" rows="2" placeholder="Nội dung" required></textarea>
                            </div>

                            <div class="col-md-12 text-center">
                                <div id="message"></div>
                                <button type="submit">Gửi</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

        </div>

        <div class="row gy-4">

            <div class="col-lg-12">
                <div class="col-lg-12 ps-lg-5" data-aos="fade-up" data-aos-delay="200">
                    <h2>@Model.Name</h2>
                    @Html.Raw(Model.Description)
                </div>
            </div>

        </div>

    </div>

</section><!-- /Portfolio Details Section -->

<style>
    .errors-message {
        background: #df1529;
        color: #ffffff;
        text-align: left;
        padding: 15px;
        margin-bottom: 24px;
        font-weight: 600;
    }

    .success-message {
        color: #ffffff;
        background: #059652;
        text-align: center;
        padding: 15px;
        margin-bottom: 24px;
        font-weight: 600;
    }
</style>

@section Scripts
{
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/js/common.js"></script>

    <script>
        $('#formQuotation').submit(function (e) {

            e.preventDefault();

            var formData = new FormData(this);

            // Chuyển FormData thành object
            var object = {};
            formData.forEach(function (value, key) {
                object[key] = value;
            });

            // Chuyển object thành JSON
            var json = JSON.stringify(object);
            // console.log("Dữ liệu JSON từ formData:\n", json);

            $.ajax({
                url: $(this).attr('action'),
                type: $(this).attr('method'),
                data: formData,
                contentType: false, // Important: Do not set content type
                processData: false, // Important: Do not process data
                success: function (response) {
                    // console.log(response);

                    if (response.status !== 'Error') {
                        $('#message').addClass('success-message').text('Nội dung đã được gửi thành công!');
                    } else {
                        $('#message').addClass('errors-message').text('Nội dung gửi thất bại!');
                    }
                },
                error: function (response) {
                    // console.log(response);
                }
            });
        });
    </script>
}
